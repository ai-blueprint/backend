# 炼丹蓝图 开发日志

> 这份文档记录了整个项目从零开始的开发过程，包括每一步的想法、决策和具体操作。
>
> **文档用途：**
> - 梳理开发思路，让自己想清楚再动手
> - 方便团队成员了解项目进度和变更原因
> - 作为个人学习和成长的记录

---

## 一、开发原则

开发过程中遵循的核心原则：

| 原则 | 说明 |
|------|------|
| **KISS** | 保持简单，别搞复杂 |
| **MVP** | 先做核心功能，别一开始就想做大而全 |
| **DRY** | 不要重复自己，能复用就复用 |
| **YAGNI** | 用不到的功能别提前做 |

**个人补充：**
- 代码要让人看得懂，别为了炫技写得很绕
- AI可以帮忙补全代码，但别让AI一次性生成大段代码
- 注释要写大白话，别写得跟论文一样

## 二、项目目标

做一个 **AI模型架构可视化设计工具**，就像 Scratch 那样拖拖拽拽就能搭建模型。

**想解决的问题：**
- 不会写代码的人也能搭建AI模型
- 研发人员可以快速验证架构想法
- 降低AI架构设计的门槛

## 三、技术栈

| 类型 | 技术 |
|------|------|
| 前端框架 | React |
| 可视化库 | React Flow |
| UI组件库 | heroUI |
| 构建工具 | Vite |
| 前端语言 | JavaScript |
| 后端语言 | Python |
| ML框架 | PyTorch |

## 四、开发计划

### 前端（已完成）

| 阶段 | 任务 | 状态 |
|------|------|------|
| 1 | 搭建基础环境，接入 React Flow | ✅ 完成 |
| 2 | 封装通用节点组件 | ✅ 完成 |
| 3 | 实现类似 Scratch 的交互操作 | ✅ 完成 |

### 后端（当前开发）

| 阶段 | 任务 |
|------|------|
| 1 | 节点定义系统：用修饰器定义节点，导出配置给前端 |
| 2 | 执行引擎：解析蓝图结构，自动构建计算图 |
| 3 | 验证评估：测试数据流通性，跑分 |

### 前后端通信（待开发）

| 阶段 | 任务 |
|------|------|
| 1 | 架构下发：前端把模型架构发给后端执行 |
| 2 | 结果反馈：后端执行结果实时同步到前端 |

---

## 五、开发日志

> 下面是实际开发过程的流水账记录，按时间顺序写的。

---

### Step 1：创建项目

我执行了uv init命令，创建了一个新的Python项目。
配置了清华镜像源，加速了依赖安装。
安装了websockets和pytorch库，准备开始开发。

### Step 2：面向理解的架构重构 (Readable & Modular)

为了让项目更加符合人类直觉，我按照“面向理解编程”的原则对代码进行了深度重构：

1. **代码风格：每行必注**：
   - 对 `engine.py`、`registry.py` 和 `loader.py` 进行了重写。
   - 实现了“每行代码尾随注释”，确保逻辑连续性，像 Scratch 一样易于阅读。

2. **逻辑解耦与模块化**：
   - **`engine.py`**：将复杂的执行逻辑拆分为 `_get_execution_order` (排序)、`_collect_inputs` (收集)、`_get_or_build_layer` (构建) 和 `_run_compute` (计算) 等独立步骤。
   - **`registry.py`**：将配置管理与前端导出逻辑分离，增加了类型推断和格式转换的私有方法。
   - **`loader.py`**：简化了动态加载逻辑，使其更加健壮。

3. **健壮性提升**：
   - 修复了 `input` 节点数据透传的逻辑漏洞。
   - 增加了对 PyTorch 标准层（`nn.Module`）的自动适配，支持字典输入与张量输入的自动转换。

### Step 3：端到端测试验证

为了确保重构后的系统依然正确，我执行了完整的回归测试：

1. **测试蓝图 ([`test_blueprint.json`](test_blueprint.json))**：
   - 模拟 MLP 链路：`Input` -> `Linear` -> `ReLU` -> `Linear` -> `Output`。

2. **测试结果**：
   - 运行 `python test_engine.py` 成功跑通。
   - 数据流：`(1, 10) -> (1, 20) -> (1, 20) -> (1, 5)`。
   - 验证了重构后的引擎在保持高可读性的同时，逻辑完全正确。

